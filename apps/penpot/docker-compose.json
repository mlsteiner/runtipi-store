{
  "schemaVersion": 2,
  "services": [
    {
      "name": "penpot-frontend",
      "image": "penpotapp/frontend:${PENPOT_VERSION:-latest}",
      "environment": [
        {
          "key": "PENPOT_FLAGS",
          "value": "disable-email-verification enable-smtp enable-prepl-server disable-secure-session-cookies"
        },
        {
          "key": "PENPOT_HTTP_SERVER_MAX_BODY_SIZE",
          "value": 31457280
        },
        {
          "key": "PENPOT_HTTP_SERVER_MAX_MULTIPART_BODY_SIZE",
          "value": 367001600
        }
      ],
      "internalPort": 8080,
      "volumes": [
        {
          "hostPath": "penpot_assets",
          "containerPath": "/opt/data/assets",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "dependsOn": [
        "penpot-backend",
        "penpot-exporter"
      ]
    },
    {
      "name": "penpot-backend",
      "image": "penpotapp/backend:${PENPOT_VERSION:-latest}",
      "environment": [
        {
          "key": "PENPOT_FLAGS",
          "value": "disable-email-verification enable-smtp enable-prepl-server disable-secure-session-cookies"
        },
        {
          "key": "PENPOT_PUBLIC_URI",
          "value": "http://localhost:9001"
        },
        {
          "key": "PENPOT_HTTP_SERVER_MAX_BODY_SIZE",
          "value": 31457280
        },
        {
          "key": "PENPOT_HTTP_SERVER_MAX_MULTIPART_BODY_SIZE",
          "value": 367001600
        },
        {
          "key": "PENPOT_SECRET_KEY",
          "value": "change-this-insecure-key"
        },
        {
          "key": "PENPOT_DATABASE_URI",
          "value": "postgresql://penpot-postgres/penpot"
        },
        {
          "key": "PENPOT_DATABASE_USERNAME",
          "value": "penpot"
        },
        {
          "key": "PENPOT_DATABASE_PASSWORD",
          "value": "penpot"
        },
        {
          "key": "PENPOT_REDIS_URI",
          "value": "redis://penpot-valkey/0"
        },
        {
          "key": "PENPOT_ASSETS_STORAGE_BACKEND",
          "value": "assets-fs"
        },
        {
          "key": "PENPOT_STORAGE_ASSETS_FS_DIRECTORY",
          "value": "/opt/data/assets"
        },
        {
          "key": "PENPOT_TELEMETRY_ENABLED",
          "value": true
        },
        {
          "key": "PENPOT_TELEMETRY_REFERER",
          "value": "compose"
        },
        {
          "key": "PENPOT_SMTP_DEFAULT_FROM",
          "value": "no-reply@example.com"
        },
        {
          "key": "PENPOT_SMTP_DEFAULT_REPLY_TO",
          "value": "no-reply@example.com"
        },
        {
          "key": "PENPOT_SMTP_HOST",
          "value": "penpot-mailcatch"
        },
        {
          "key": "PENPOT_SMTP_PORT",
          "value": 1025
        },
        {
          "key": "PENPOT_SMTP_USERNAME",
          "value": null
        },
        {
          "key": "PENPOT_SMTP_PASSWORD",
          "value": null
        },
        {
          "key": "PENPOT_SMTP_TLS",
          "value": false
        },
        {
          "key": "PENPOT_SMTP_SSL",
          "value": false
        }
      ],
      "volumes": [
        {
          "hostPath": "penpot_assets",
          "containerPath": "/opt/data/assets",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "dependsOn": {
        "penpot-postgres": {
          "condition": "service_healthy"
        },
        "penpot-valkey": {
          "condition": "service_healthy"
        }
      }
    },
    {
      "name": "penpot-exporter",
      "image": "penpotapp/exporter:${PENPOT_VERSION:-latest}",
      "environment": [
        {
          "key": "PENPOT_SECRET_KEY",
          "value": "change-this-insecure-key"
        },
        {
          "key": "PENPOT_PUBLIC_URI",
          "value": "http://penpot-frontend:8080"
        },
        {
          "key": "PENPOT_REDIS_URI",
          "value": "redis://penpot-valkey/0"
        }
      ],
      "dependsOn": {
        "penpot-valkey": {
          "condition": "service_healthy"
        }
      }
    },
    {
      "name": "penpot-postgres",
      "image": "postgres:15",
      "environment": [
        {
          "key": "POSTGRES_INITDB_ARGS",
          "value": "--data-checksums"
        },
        {
          "key": "POSTGRES_DB",
          "value": "penpot"
        },
        {
          "key": "POSTGRES_USER",
          "value": "penpot"
        },
        {
          "key": "POSTGRES_PASSWORD",
          "value": "penpot"
        }
      ],
      "volumes": [
        {
          "hostPath": "penpot_postgres_v15",
          "containerPath": "/var/lib/postgresql/data",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "healthCheck": {
        "test": "pg_isready -U penpot",
        "interval": "2s",
        "timeout": "10s",
        "retries": 5,
        "startPeriod": "2s"
      },
      "stopSignal": "SIGINT"
    },
    {
      "name": "penpot-valkey",
      "image": "valkey/valkey:8.1",
      "environment": [
        {
          "key": "VALKEY_EXTRA_FLAGS",
          "value": "--maxmemory 128mb --maxmemory-policy volatile-lfu"
        }
      ],
      "healthCheck": {
        "test": "valkey-cli ping | grep PONG",
        "interval": "1s",
        "timeout": "3s",
        "retries": 5,
        "startPeriod": "3s"
      }
    },
    {
      "name": "penpot-mailcatch",
      "image": "sj26/mailcatcher:latest",
      "internalPort": 1080
    }
  ]
}